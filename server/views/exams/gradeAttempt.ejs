<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade Attempt - <%= student.full_name %></title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/mobile.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://demos.creative-tim.com/notus-js/assets/styles/tailwind.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="stylesheet"
    href="https://demos.creative-tim.com/notus-js/assets/vendor/@fortawesome/fontawesome-free/css/all.min.css">
    
  <style>
    .modern-container {
        max-width: 1200px;
        margin: 48px auto;
        padding: 2.5rem 2rem;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 4px 24px rgba(44,62,80,0.10);
        border: 1px solid #e3e6ed;
        animation: fadeIn 0.45s ease;
    }
    .modern-title {
        font-size: 1.6rem;
        font-weight: 700;
        color: #2375D8;
    }
    .modern-title small {
        display: block;
        font-size: 1rem;
        font-weight: 400;
        color: #6b7280;
    }
    .modern-btn-primary, .modern-btn-secondary {
        font-weight:700;
        padding:0.75rem 1rem;
        border:none;
        border-radius:10px;
        cursor:pointer;
        display:inline-flex;
        gap:0.6rem;
        align-items:center;
        justify-content:center;
        text-decoration: none;
    }
    .modern-btn-primary { background: linear-gradient(90deg, #2375D8 0%, #0c9083 100%); color: #fff; }
    .modern-btn-secondary { background:#e6eef8; color:#2b6cb0; }
    
    .score-summary {
        background: #f9fafb;
        border: 1px solid #e6e9ef;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        display: flex;
        gap: 2rem;
        justify-content: center;
    }
    .score-summary-item h5 { margin:0; font-size:1rem; color:#6b7280; }
    .score-summary-item strong { font-size:1.5rem; color:#2375D8; }

    .grading-card {
        background: #fff;
        border: 1px solid #e3e6ed;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 8px rgba(44,62,80,0.06);
        overflow: hidden;
    }
    .grading-card-header {
        background: #f9fafb;
        padding: 0.9rem 1.25rem;
        border-bottom: 1px solid #e3e6ed;
    }
    .grading-card-header h5 {
        font-size: 1.1rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
    }
    .grading-card-body { padding: 1.25rem; }
    .student-answer {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }
    .student-answer p { margin:0; }
    .student-answer ul { margin-bottom: 0; }
    .modern-form-group { margin-bottom: 1rem; }
    .modern-form-group label { display:block; margin-bottom:0.45rem; font-weight:600; color:#374151; }
    .modern-form-control {
        width:100%;
        padding:0.7rem;
        border:1px solid #e2e8f0;
        border-radius:8px;
        font-size:1rem;
    }
    .grading-inputs { display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; }
    @media(max-width: 640px) { .grading-inputs { grid-template-columns: 1fr; } }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(18px); }
        to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
<%- include('../shared/header') %>

<main>
<div class="modern-container">
    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1.5rem;">
        <div>
            <h2 class="modern-title">
                Grade Attempt
                <small>For: <%= student.full_name %></small>
            </h2>
            <p class="text-muted" style="margin-top:0.5rem;">Exam: <%= attempt.exam_title %> — Attempt #<%= attempt.attempt_no %></p>
        </div>
        <a href="/exams/<%= attempt.exam_id %>/assign" class="modern-btn-secondary"><i class="fas fa-arrow-left"></i> Back</a>
    </div>

  <form id="gradeForm" method="post" action="/exams/attempts/<%= attempt.attempt_id %>/grade">
    <input type="hidden" name="attemptId" value="<%= attempt.attempt_id %>">

    <div class="score-summary">
        <div class="score-summary-item text-center">
            <h5>Auto-Graded Score</h5>
            <strong><%= attempt.auto_score %></strong>
        </div>
        <div class="score-summary-item text-center">
            <h5>Manual Score</h5>
            <strong><%= attempt.manual_score %></strong>
        </div>
        <div class="score-summary-item text-center">
            <h5>Total Score</h5>
            <strong><%= attempt.total_score %></strong>
        </div>
    </div>

    <% responses.forEach((r, index) => { %>
      <div class="grading-card">
        <div class="grading-card-header">
          <h5>Question <%= index + 1 %>: <%- r.body_text %></h5>
        </div>
        <div class="grading-card-body">
            <label class="form-label" style="font-weight:600;">Student's Answer</label>
            <div class="student-answer">
              <% if (r.type_name === 'Câu hỏi trắc nghiệm') { %>
                <p><strong>Selected:</strong> <%= r.selected_option_text || 'Not answered' %></p>
                <% if(r.is_correct) { %>
                    <span style="color: #16a34a; font-weight:bold;">Correct</span>
                <% } else { %>
                    <span style="color: #dc2626; font-weight:bold;">Incorrect</span>
                <% } %>
              <% } else { %>
                <p><strong>Essay response:</strong></p>
                <div style="white-space: pre-wrap;"><%= r.response_text || 'No text submitted.' %></div>
                <% if (r.files && r.files.length > 0) { %>
                  <p class="mt-3"><strong>Attachments:</strong></p>
                  <ul>
                    <% r.files.forEach(f => { %>
                      <li><a href="/<%= f.file_url %>" target="_blank" class="text-primary"><%= f.file_name %></a></li>
                    <% }) %>
                  </ul>
                <% } %>
              <% } %>
            </div>

            <% if (r.type_name !== 'Câu hỏi trắc nghiệm') { %>
                <div class="grading-inputs mt-4">
                    <div class="modern-form-group">
                      <label for="score_<%= r.response_id %>">Score (out of <%= r.points %>)</label>
                      <input type="number" step="0.01" min="0" max="<%= r.points %>" class="modern-form-control" name="scores[<%= r.response_id %>]" id="score_<%= r.response_id %>" value="<%= r.score || '' %>">
                    </div>
                    <div class="modern-form-group">
                      <label for="comment_<%= r.response_id %>">Grader Comment</label>
                      <textarea class="modern-form-control" name="comments[<%= r.response_id %>]" id="comment_<%= r.response_id %>"><%= r.grader_comment || '' %></textarea>
                    </div>
                </div>
            <% } %>
        </div>
      </div>
    <% }) %>

    <div style="display:flex; justify-content:flex-end; margin-top:2rem;">
      <button type="submit" class="modern-btn-primary"><i class="fas fa-save"></i> Save Grades</button>
    </div>
  </form>
</div>
</main>

<%- include('../shared/footer') %>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="/js/script.js"></script>
</body>

</html>