<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Exam Scores</title>

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/mobile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://demos.creative-tim.com/notus-js/assets/styles/tailwind.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        /* Modern container (align with examList styles) */
        main, .modern-container { flex: 1 0 auto; }
        .modern-container {
            max-width: 1200px;
            margin: 48px auto;
            padding: 1.6rem;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 8px 30px rgba(44,62,80,0.06);
            border: 1px solid #eef4fb;
            animation: fadeIn .35s ease;
        }
        .page-title { display:flex; align-items:center; gap:.8rem; font-size:1.25rem; font-weight:700; color:#2375D8; }
        .muted { color:#6b7280; font-size:.95rem; }
        .toolbar { display:flex; gap:.6rem; align-items:center; }
        .btn-secondary, .btn-primary {
            padding:.5rem .8rem; border-radius:10px; font-weight:700; cursor:pointer; display:inline-flex; align-items:center; gap:.5rem; border:1px solid transparent;
        }
        .btn-secondary { background:#f3f6fb; color:#2375D8; border-color:#e6eef8; }
        .btn-primary { background:linear-gradient(90deg,#2375D8 0%,#06b6d4 100%); color:#fff; box-shadow:0 8px 24px rgba(35,117,216,0.08); }
        .card {
    border-radius: 10px;
    border: 1px solid #eef4fb;
    overflow: hidden;
    background: #fff;
    margin: 0 auto; /* Căn giữa */
    width: 100%; /* Chiếm toàn bộ chiều rộng */
}
        .card-header { padding:1rem 1.25rem; border-bottom:1px solid #f1f6fb; background:linear-gradient(90deg, rgba(35,117,216,0.04), rgba(6,182,212,0.02)); }
        .card-body { padding:1rem 1.25rem; }
        .table thead th { font-weight:700; color:#334155; padding:.9rem .75rem; text-align:left; }
        .table tbody td { padding:.75rem .75rem; color:#374151; vertical-align:middle; }
        .badge { padding:.25rem .6rem; border-radius:999px; font-weight:700; font-size:.85rem; }
        .bg-secondary { background:#9ca3af; color:#fff; }
        .bg-warning { background:#f59e0b; color:#111827; }
        .bg-success { background:#10b981; color:#fff; }
        .bg-info { background:#06b6d4; color:#fff; }
        .text-center { text-align:center; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:none;} }
        .small-muted { color:#7b8794; font-size:.88rem; }
        .table-responsive { overflow:auto; }
        .actions { display:flex; gap:.5rem; align-items:center; }
        .btn-outline-primary { border:1px solid #2375D8; color:#2375D8; background:transparent; padding:.35rem .6rem; border-radius:8px; font-size:.85rem; }
    </style>
</head>
<body>
<%- include('../shared/header') %>

<main>
    <div class="modern-container">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;margin-bottom:1rem;">
            <div>
                <div class="page-title"><i class="fas fa-chart-line"></i> Exam Scores</div>
                <div class="muted" style="margin-top:.25rem;">
                    <strong><%= assignment.exam_title %></strong> • Class: <span class="small-muted"><%= assignment.class_name %></span>
                    <div class="small-muted" style="margin-top:.25rem;">Exam Code: <%= assignment.exam_code %></div>
                </div>
            </div>
            <div class="toolbar">
                <a href="/exams/<%= assignment.assignment_id %>/assign" class="btn-secondary" title="Back to assignment">
                    <i class="fas fa-arrow-left"></i> Back
                </a>
            </div>
        </div>

        <% if (flashMessage) { %>
            <div class="alert alert-<%= flashMessage.type %> alert-dismissible fade show" role="alert" style="margin-bottom:1rem;">
                <%= flashMessage.message %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <% } %>

        <div class="card">
            <div class="card-header">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div style="font-weight:700;color:#0f1724;">Student Scores</div>
                    <div class="small-muted">Total: <strong><%= scores.length %></strong></div>
                </div>
            </div>

            <div class="card-body">
                <div class="table-responsive">
                    <table class="table" style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th style="width:90px;">Latest Attempt</th>
                                <th style="width:110px;">Score</th>
                                <th style="width:160px;">Started</th>
                                <th style="width:160px;">Submitted</th>
                                <th style="width:220px;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% scores.forEach(score => { %>
                                <tr>
                                    <td style="font-weight:600;"><%= score.student_name %></td>
                                    <td><%= score.attempt_no || 'Not attempted' %></td>
                                    <td>
                                        <% if (score.score !== null) { %>
                                            <span><%= score.score %></span>
                                        <% } else if (score.submitted_at) { %>
                                            <span class="small-muted">Pending grading</span>
                                        <% } else if (score.started_at) { %>
                                            <span class="small-muted">In progress</span>
                                        <% } else { %>
                                            <span class="small-muted">Not started</span>
                                        <% } %>
                                    </td>
                                    <td>
                                        <%= score.started_at ? new Date(score.started_at).toLocaleString('en-US', {
                                            year: 'numeric', month: 'short', day: 'numeric',
                                            hour: '2-digit', minute: '2-digit'
                                        }) : 'N/A' %>
                                    </td>
                                    <td>
                                        <%= score.submitted_at ? new Date(score.submitted_at).toLocaleString('en-US', {
                                            year: 'numeric', month: 'short', day: 'numeric',
                                            hour: '2-digit', minute: '2-digit'
                                        }) : 'N/A' %>
                                    </td>
                                    <td>
                                        <div class="actions">
                                            <% if (!score.started_at) { %>
                                                <span class="badge bg-secondary">Not Started</span>
                                            <% } else if (!score.submitted_at) { %>
                                                <span class="badge bg-warning">In Progress</span>
                                            <% } else if (score.status === 'in_progress') { %>
                                                <span class="badge bg-warning">In Progress</span>
                                            <% } else if (score.status === 'graded') { %>
                                                <span class="badge bg-success">Graded</span>
                                            <% } else { %>
                                                <span class="badge bg-info">Awaiting Manual Grading</span>
                                            <% } %>

                                            <% if (score.submitted_at && score.status !== 'graded') { %>
                                                <a href="/exams/attempts/<%= score.attempt_id %>/grade" class="btn-outline-primary" style="margin-left:.5rem;">Grade</a>
                                            <% } %>
                                        </div>
                                    </td>
                                </tr>
                            <% }) %>

                            <% if (scores.length === 0) { %>
                                <tr>
                                    <td colspan="6" class="text-center small-muted" style="padding:2rem;">No students enrolled in this class</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>

<%- include('../shared/footer') %>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="/js/script.js"></script>
</body>
</html>